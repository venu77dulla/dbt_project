ID	NO	QUERY
100	1	TRUNCATE TABLE STAGE_CUSTOMER;
100	2	INSERT INTO  STAGE_CUSTOMER
SELECT C_CUSTKEY
,C_NAME
,C_ADDRESS
,C_NATIONKEY
,C_PHONE
,C_ACCTBAL
,C_MKTSEGMENT
,C_COMMENT
,CURRENT_TIMESTAMP AS INSERT_GMT_TIMESTAMP FROM 
SNOWFLAKE_SAMPLE_DATA.TPCH_SF1.CUSTOMER;
100	3	TRUNCATE TABLE DIM_CUSTOMER;
100	4	DELETE FROM STAGE_CUSTOMER STAGE_C
WHERE EXISTS (
SELECT 1 FROM DIM_CUSTOMER DIM_C
WHERE
DIM_C.C_CUSTKEY=STAGE_C.C_CUSTKEY
);
100	5	INSERT INTO DIM_CUSTOMER 
 SELECT C_CUSTKEY
,C_NAME
,C_ADDRESS
,C_NATIONKEY
,C_PHONE
,C_ACCTBAL
,C_MKTSEGMENT
,C_COMMENT
,CURRENT_TIMESTAMP AS INSERT_GMT_TIMESTAMP 
FROM
STAGE_CUSTOMER;
200	1	TRUNCATE TABLE STAGE_LINEITEM;
200	2			INSERT INTO STAGE_LINEITEM
		SELECT L_ORDERKEY
			,L_PARTKEY
			,L_SUPPKEY
			,L_LINENUMBER
			,L_QUANTITY
			,L_EXTENDEDPRICE
			,L_DISCOUNT
			,L_TAX
			,L_RETURNFLAG
			,L_LINESTATUS
			,L_SHIPDATE
			,L_COMMITDATE
			,L_RECEIPTDATE
			,L_SHIPINSTRUCT
			,L_SHIPMODE
			,L_COMMENT
			,CURRENT_TIMESTAMP AS GMT_TIMESTAMP 
			FROM
			SNOWFLAKE_SAMPLE_DATA.TPCH_SF1.LINEITEM;
200	3		DELETE FROM DIM_LINEITEM DIM_L
	WHERE EXISTS (
	SELECT 1 FROM STAGE_LINEITEM STAGE_L
	WHERE
	DIM_L.L_ORDERKEY=STAGE_L.L_ORDERKEY
	);
200	4			INSERT INTO DIM_LINEITEM
		SELECT L_ORDERKEY
			,L_PARTKEY
			,L_SUPPKEY
			,L_LINENUMBER
			,L_QUANTITY
			,L_EXTENDEDPRICE
			,L_DISCOUNT
			,L_TAX
			,L_RETURNFLAG
			,L_LINESTATUS
			,L_SHIPDATE
			,L_COMMITDATE
			,L_RECEIPTDATE
			,L_SHIPINSTRUCT
			,L_SHIPMODE
			,L_COMMENT
			,CURRENT_TIMESTAMP AS GMT_TIMESTAMP 
			FROM
			STAGE_LINEITEM;
300	1	TRUNCATE TABLE STAGE_NATION;
300	2			INSERT INTO STAGE_NATION
        SELECT N_NATIONKEY
		,N_NAME
		,N_REGIONKEY
		,N_COMMENT
		,CURRENT_TIMESTAMP AS GMT_TIMESTAMP 
		FROM
		SNOWFLAKE_SAMPLE_DATA.TPCH_SF1.NATION;
300	3		    	DELETE FROM DIM_NATION DIM_N
	WHERE EXISTS (
	SELECT 1 FROM STAGE_NATION STAGE_N
	WHERE
	DIM_N.N_NAME=STAGE_N.N_NAME
	);
300	4	INSERT INTO DIM_NATION
        SELECT N_NATIONKEY
		,N_NAME
		,N_REGIONKEY
		,N_COMMENT
		,CURRENT_TIMESTAMP AS GMT_TIMESTAMP 
		FROM
		STAGE_NATION;
400	1	TRUNCATE TABLE STAGE_ORDERS;
400	2		INSERT INTO STAGE_ORDERS SELECT
	O_ORDERKEY
	,O_CUSTKEY
	,O_ORDERSTATUS
	,O_TOTALPRICE
	,O_ORDERDATE
	,O_ORDERPRIORITY
	,O_CLERK
	,O_SHIPPRIORITY
	,O_COMMENT
	,CURRENT_TIMESTAMP AS GMT_TIMESTAMP 
	FROM
	SNOWFLAKE_SAMPLE_DATA.TPCH_SF1.ORDERS;
400	3		DELETE FROM DIM_ORDERS DIM_O
	WHERE EXISTS (
	SELECT 1 FROM STAGE_ORDERS STAGE_O
	WHERE
	DIM_O.O_ORDERKEY=STAGE_O.O_ORDERKEY
	);
400	4	    INSERT INTO DIM_ORDERS SELECT
	O_ORDERKEY
	,O_CUSTKEY
	,O_ORDERSTATUS
	,O_TOTALPRICE
	,O_ORDERDATE
	,O_ORDERPRIORITY
	,O_CLERK
	,O_SHIPPRIORITY
	,O_COMMENT
	,CURRENT_TIMESTAMP AS GMT_TIMESTAMP 
	FROM STAGE_ORDERS;
